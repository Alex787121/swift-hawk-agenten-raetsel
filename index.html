<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Swift & Hawk — Agentenrätsel</title>
<style>
    body {
        margin: 0;
        font-family: Inter, Arial, sans-serif;
        background: linear-gradient(108deg, #02101a, #02101a, #071022);
        color: #86dcfb;
        padding: 18px;
    }
    .container {
        max-width: 900px;
        margin: auto;
    }
    h1, h2, h3 {
        color: #fff;
    }
    .card {
        background: rgba(255,255,255,0.05);
        padding: 16px;
        margin-bottom: 16px;
        border-radius: 12px;
        border: 1px solid rgba(255,255,255,0.08);
    }
    input, button, select {
        padding: 10px;
        margin-top: 8px;
        border-radius: 8px;
        border: none;
        width: 100%;
    }
    button {
        cursor: pointer;
        background: #1277ff;
        color: white;
        font-weight: bold;
        margin-top: 10px;
    }
    button:hover {
        background: #0d5fd6;
    }
    .mission {
        background: rgba(255,255,255,0.05);
        padding: 20px;
        border-radius: 12px;
        margin-bottom: 12px;
        display: none;
    }
    .mission.done {
        opacity: 0.4;
    }
    .mission input {
        width: 70%;
    }
    #timer {
        font-size: 20px;
        font-weight: bold;
        color: #6cfba1;
    }
</style>
</head>

<body>
<div class="container">

<h1>Swift & Hawk — Agentenrätsel (10 Missionen)</h1>

<div class="card">
    <h2>Agenten-Login</h2>

    <p>Gib deinen Codenamen ein (wird im Browser gespeichert):</p>
    <input id="agentName" placeholder="Agentenname">

    <label style="margin-top:10px; display:flex; align-items:center; gap:10px;">
        <input type="checkbox" id="useFirebase">
        <span>Aktiv: Online-Bestenliste (Firebase, optional)</span>
    </label>

    <button onclick="startRun()">Start Missionen</button>
    <button style="background:#d63333" onclick="clearName()">Name löschen</button>

    <p style="font-size:13px; opacity:0.7;">
        Tipp: Wenn du Firebase verwenden willst, ergänze die Datei <b>firebase-config.js</b> wie im README beschrieben.
    </p>
</div>

<div class="card">
    <h2>Bestenliste</h2>
    <button onclick="loadLeaderboard()">Aktualisieren</button>
    <div id="leaderboard"></div>
</div>

<div id="missions"></div>

<div id="timer"></div>

</div>

<!-- Sounds -->
<audio id="sound-ok" src="assets/ok.wav"></audio>
<audio id="sound-wrong" src="assets/wrong.wav"></audio>
<audio id="sound-complete" src="assets/complete.wav"></audio>

<script>

// --- 10 MISSIONEN ---
const missions = [
    { id: 1, question: "Mission 1: Entschlüssele den Code: 12-5-20-20-5-18", answer: "letter" },
    { id: 2, question: "Mission 2: Binär zu Text: 01000001", answer: "a" },
    { id: 3, question: "Mission 3: Welches Wort passt nicht? Hund – Katze – Orange – Maus", answer: "orange" },
    { id: 4, question: "Mission 4: 5 + (12 × 3) – 11 =", answer: "30" },
    { id: 5, question: "Mission 5: Geheimfrage: Was ist die Hauptstadt von Österreich?", answer: "wien" },
    { id: 6, question: "Mission 6: Sortiere die Buchstaben: K A T R E", answer: "karte" },
    { id: 7, question: "Mission 7: Drehe das Wort um: TNEGA", answer: "agent" },
    { id: 8, question: "Mission 8: Caesar-Chiffre +3: Jdqwhq", answer: "agenten" },
    { id: 9, question: "Mission 9: Wie viele E’s sind in diesem Satz? 'Der geheime Server sei sehr sicher.'", answer: "8" },
    { id: 10, question: "Mission 10: Letzte Aufgabe: 2 hoch 5 =", answer: "32" }
];

let current = 0;
let startTime = 0;
let timerInterval = null;

// Helpers
function el(id){ return document.getElementById(id); }
function secToStr(sec){
    const m = Math.floor(sec/60);
    const s = sec % 60;
    return String(m).padStart(2,"0")+":"+String(s).padStart(2,"0");
}
function play(id){
    const s = el("sound-"+id);
    if(!s) return;
    try { s.currentTime = 0; s.play(); } catch(e){}
}

function renderMissions(){
    const container = el("missions");
    container.innerHTML = "";

    missions.forEach((m, idx)=>{
        const box = document.createElement("div");
        box.className = "mission";
        box.id = "m"+m.id;
        box.innerHTML = `
            <h3>Mission ${m.id}</h3>
            <p>${m.question}</p>
            <input id="inp-${m.id}" placeholder="Antwort eingeben…">
            <button onclick="tryMission(${m.id})">Senden</button>
        `;
        container.appendChild(box);
    });
}

function saveName(){
    const n = el("agentName").value.trim();
    if(!n) return alert("Bitte Codenamen eingeben.");
    localStorage.setItem("agentName", n);
    return n;
}

function clearName(){
    localStorage.removeItem("agentName");
    alert("Name gelöscht.");
    location.reload();
}

function startRun(){
    const name = saveName();
    if(!name) return;

    renderMissions();
    current = 1;
    showMission(1);

    startTime = Date.now();
    startTimer();
}

function showMission(id){
    missions.forEach(m=>{
        el("m"+m.id).style.display = (m.id === id) ? "block" : "none";
    });
}

function tryMission(id){
    const m = missions.find(x=>x.id===id);
    const user = el("inp-"+id).value.trim().toLowerCase();
    if(user === m.answer){
        play("ok");
        el("m"+id).classList.add("done");
        current++;

        if(current <= missions.length){
            showMission(current);
        } else {
            finishRun();
        }
    } else {
        play("wrong");
        alert("Falsche Antwort!");
    }
}

function startTimer(){
    timerInterval = setInterval(()=>{
        const now = Date.now();
        const diff = Math.floor((now - startTime)/1000);
        el("timer").innerText = "Zeit: " + secToStr(diff);
    }, 250);
}

function finishRun(){
    clearInterval(timerInterval);
    play("complete");

    const totalSec = Math.floor((Date.now() - startTime)/1000);
    const name = localStorage.getItem("agentName");
    saveLocalScore({ name, time: totalSec });

    alert("Missionen abgeschlossen! Zeit: "+secToStr(totalSec));
}

// Lokale Bestenliste
function saveLocalScore(entry){
    const list = JSON.parse(localStorage.getItem("scores") || "[]");
    list.push(entry);
    list.sort((a,b)=>a.time-b.time);
    localStorage.setItem("scores", JSON.stringify(list));
}

function loadLeaderboard(){
    const list = JSON.parse(localStorage.getItem("scores") || "[]");
    const box = el("leaderboard");
    box.innerHTML = "<h3>Lokale Bestzeiten</h3>";

    list.slice(0,10).forEach((e,i)=>{
        box.innerHTML += `<div>${i+1}. ${e.name} — ${secToStr(e.time)}</div>`;
    });
}

// Firebase optional
async function fetchOnlineScores(){ return []; }
async function submitScoreOnline(){}

// AUTO-INIT
(function(){
    const stored = localStorage.getItem("agentName");
    if(stored) el("agentName").value = stored;
})();

</script>
</body>
</html>
